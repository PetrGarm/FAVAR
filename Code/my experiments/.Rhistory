start <- start(X)
frequency <- frequency(X)
X = X[1:length(y),]
Y = Y[1:length(y),]
X_slow = X_slow[1:length(y),]
N = dim(X)[2]
M = dim(Y)[2]
T = dim(X)[1]
# extract PC from X
XtX = t(X) %*% X
spectral_decomposition <- eigen(XtX)
eig_vec <- spectral_decomposition$vectors
eig_val <- spectral_decomposition$values
lam <- 1/sqrt(N) * eig_vec[,(1:K)]
F0 <- data.matrix(X) %*% lam
#extract PC from X_slow
XtX = t(X_slow) %*% X_slow
spectral_decomposition <- eigen(XtX)
eig_vec <- spectral_decomposition$vectors
eig_val <- spectral_decomposition$values
nslow <- dim(X_slow)[2]
lam <- 1 / sqrt(nslow) * eig_vec[,(1:K)]
Fslow0 <- data.matrix(X_slow) %*% lam
# Factors rotation
ones_vec = rep(1, T)
Ffast = data.matrix(X[,i_name]) # interest rate
k1 = dim(Ffast)[2] # (num of Ffast)
ly = cbind(ones_vec, Ffast, Fslow0)
svd <- svd(ly)
vl <-svd$u
d <- 1 / svd$d
vr <- svd$v
b = (vr * matrix(data = rep(d, dim(vr)[1]), ncol = dim(vr)[1], byrow = TRUE)) %*% (t(vl) %*% F0)
Ffast_ktimes = matrix(rep(Ffast, K), ncol = K)
coeffs = matrix(rep(b[2:(k1+1),], dim(Ffast_ktimes)[1]), ncol=K, byrow = TRUE)
Fr = F0 - Ffast_ktimes*coeffs
# FAVAR with clean factors
Y_for_VAR = cbind(Fr, Y) #Y
factor_names = paste('factor', 1:K)
colnames(Y_for_VAR)[1:K] <- factor_names
Y_for_VAR <- ts(Y_for_VAR, start = start, frequency = frequency)
VARselect(Y_for_VAR)
p = VARselect(Y_for_VAR)$selection[1] # according AIC
var <- VAR(Y_for_VAR, p)
y_hat <- forecast(var, h=h)
return(y_hat)
}
print(colnames(Y))
# cpi
errors_FAVAR_cv <- my_tsCV(y = Y[,1], forecastfunction = fore_FAVAR, y_name="aRUCPI_slow",
h = 12, X = X, Y = Y, X_slow = X_slow, K = 1, i_name = "RUCBIR=ECI",
initial = 200)
res_FAVAR <- sqrt(colMeans(errors_FAVAR_cv^2, na.rm = TRUE))
res_FAVAR
fore_FAVAR <- function(X, Y, X_slow, K, y_name, i_name, h, y){
start <- start(X)
frequency <- frequency(X)
X = X[1:length(y),]
Y = Y[1:length(y),]
X_slow = X_slow[1:length(y),]
N = dim(X)[2]
M = dim(Y)[2]
T = dim(X)[1]
# extract PC from X
XtX = t(X) %*% X
spectral_decomposition <- eigen(XtX)
eig_vec <- spectral_decomposition$vectors
eig_val <- spectral_decomposition$values
lam <- 1/sqrt(N) * eig_vec[,(1:K)]
F0 <- data.matrix(X) %*% lam
#extract PC from X_slow
XtX = t(X_slow) %*% X_slow
spectral_decomposition <- eigen(XtX)
eig_vec <- spectral_decomposition$vectors
eig_val <- spectral_decomposition$values
nslow <- dim(X_slow)[2]
lam <- 1 / sqrt(nslow) * eig_vec[,(1:K)]
Fslow0 <- data.matrix(X_slow) %*% lam
# Factors rotation
ones_vec = rep(1, T)
Ffast = data.matrix(Y[,i_name]) # interest rate
k1 = dim(Ffast)[2] # (num of Ffast)
ly = cbind(ones_vec, Ffast, Fslow0)
svd <- svd(ly)
vl <-svd$u
d <- 1 / svd$d
vr <- svd$v
b = (vr * matrix(data = rep(d, dim(vr)[1]), ncol = dim(vr)[1], byrow = TRUE)) %*% (t(vl) %*% F0)
Ffast_ktimes = matrix(rep(Ffast, K), ncol = K)
coeffs = matrix(rep(b[2:(k1+1),], dim(Ffast_ktimes)[1]), ncol=K, byrow = TRUE)
Fr = F0 - Ffast_ktimes*coeffs
# FAVAR with clean factors
Y_for_VAR = cbind(Fr, Y)#Y
factor_names = paste('factor', 1:K)
colnames(Y_for_VAR)[1:K] <- factor_names
Y_for_VAR <- ts(Y_for_VAR, start = start, frequency = frequency)
VARselect(Y_for_VAR)
p = VARselect(Y_for_VAR)$selection[1] # according AIC
var <- VAR(Y_for_VAR, p)
y_hat <- forecast(var, h=h)
return(y_hat)
}
y_names <- c("aRUCPI_slow", "RUCBIR=ECI")
#y_names <- c("aRUCPI_slow", "RUCBIR=ECI", "RUUNR=ECI_slow")
y_index <- seq(N)[colnames(ts) %in% y_names]
'%not_in%' <- Negate('%in%')
x_index <- which(seq(N) %not_in% y_index)
slow_index_not_y <- slow_index[slow_index %not_in% y_index] # w.r.t ts object
Y <- ts[,y_index]
X <- ts[,x_index]
X_slow <- ts[,slow_index_not_y]
print(colnames(Y))
T <- dim(Y)[1]
# cpi
errors_FAVAR_cv <- my_tsCV(y = Y[,2], forecastfunction = fore_FAVAR, y_name="aRUCPI_slow",
h = 12, X = X, Y = Y, X_slow = X_slow, K = 1, i_name = "RUCBIR=ECI",
initial = 200)
res_FAVAR <- sqrt(colMeans(errors_FAVAR_cv^2, na.rm = TRUE))
res_FAVAR
dim(for_modeling)
#gdp
obs_gdp <- dim(na.omit(for_modeling['RUGDP=ECI_slow']))[1]
df_gdp <- for_modeling[(71):240,]
# Complete series only
complete_series_indices = c()
for(i in 1:N_for_modeling) {
if (sum(is.na(df_gdp[,i])) == 0) {
complete_series_indices = c(complete_series_indices, i)
}
}
df_gdp <- df_gdp[,complete_series_indices]
colnames(df_gdp) <- colnames(for_modeling)[complete_series_indices]
ts_gdp <- ts(df_gdp, start=c(2005,11), frequency = 12)
N_gdp <- dim(ts_gdp)[2]
T_gdp <- dim(ts_gdp)[1]
transformations_gdp <- rep(0, N)
# Standardize & SA for some reason (correct PCA extraction probably)
for (i in 1:N_gdp){
ts_gdp[,i] <- (ts_gdp[,i] - mean(ts_gdp[,i])) / sd(ts_gdp[,i])
transformations_gdp[i] <- ndiffs(ts_gdp[,i])
}
# induce stationarity
for (i in 1:N_gdp) {
NAs <- rep(NA, transformations_gdp[i])
if(transformations_gdp[i] != 0) {
ts_gdp[,i] = c(NAs, diff(ts_gdp[,i], transformations_gdp[i]))
}
}
ts_gdp <- na.omit(ts_gdp)
dim(ts_gdp)
colnames(ts)
colnames(ts_gdp)
unique(c(colnames(ts), colnames(ts_gdp)))
unique(c(1,1))
unique(c(1,2,1))
colnames(ts) %in% colnames(ts_gdp)
var_diffs <- transformations_gdp
for (i in 1:len(variables)) {
transform_code <- NA
if(var_diffs[i] == 0) {
transform_code <- 'l'
} else {
transform_code <- paste0('\delta^', var_diffs[i])
}
print(paste0(variables[i], ' &', '& ', transform_code))
}
for (i in 1:len(variables)) {
transform_code <- NA
if(var_diffs[i] == 0) {
transform_code <- 'l'
} else transform_code <- paste0('\delta^', var_diffs[i])
print(paste0(variables[i], ' &', '& ', transform_code))
}
for (i in 1:len(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('\delta^', var_diffs[i])
print(paste0(variables[i], ' &', '& ', transform_code))
}
###
variables <- ts_gdp
var_diffs <- transformations_gdp
for (i in 1:len(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('\delta^', var_diffs[i])
print(paste0(variables[i], ' &', '& ', transform_code))
}
for (i in 1:len(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('\\delta^', var_diffs[i])
print(paste0(variables[i], ' &', '& ', transform_code))
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('\\delta^', var_diffs[i])
print(paste0(variables[i], ' &', '& ', transform_code))
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('\\delta^', var_diffs[i])
print(paste0(variables[i], ' & ', '& ', transform_code))
}
###
variables <- colnames(ts_gdp)
var_diffs <- transformations_gdp
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('\\delta^', var_diffs[i])
print(paste0(variables[i], ' & ', '& ', transform_code))
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('\\delta^', var_diffs[i])
print(paste0(variables[i], ' & ', '& ', transform_code, '\\\\'))
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('\\delta^', var_diffs[i])
print(paste0(i,". ",variables[i], ' & ', '& ', transform_code, '\\\\'))
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('\\delta^', var_diffs[i])
print(paste0(i,". ",variables[i], ' & ', '& ', transform_code, '\\'))
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('\\delta^', var_diffs[i])
cat(paste0(i,". ",variables[i], ' & ', '& ', transform_code, '\\'))
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('\\delta^', var_diffs[i])
cat(paste0(i,". ",variables[i], ' & ', '& ', transform_code, '\\', '\n'))
}
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('\\delta^', var_diffs[i])
cat(paste0(i,". ",variables[i], ' & ', '& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('$\\delta^', var_diffs[i],'$')
cat(paste0(i,". ",variables[i], ' & ', '& ', transform_code, '\\\\', '\n'))
}
sub(c("="), ('.'), y_name)
sub(c("="), c('.'), y_name)
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- 'l'
else
transform_code <- paste0('$\\delta^', var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ', '& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
else
transform_code <- paste0('$\\delta^', var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ', '& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
else
transform_code <- paste0('$\\delta^', var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ', '& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
else if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
esle transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ', '& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ', '& ', transform_code, '\\\\', '\n'))
}
library(readxl)
real_big_data_alina_info <- read_excel("C:/Users/petrg/Desktop/Данные для диплома/real_big_data_alina_info.xlsx",
range = "A4:L298")
View(real_big_data_alina_info)
data_info <- read_excel("C:/Users/petrg/Desktop/Данные для диплома/real_big_data_alina_info.xlsx",
range = "A4:L298")
variables[1]
select(data_info, RIC=variables[1])
select(data_info, RIC==variables[1])
select(data_info, where(RIC=variables[1]))
data_info[data_info$RIC == variables[1],]
variables[1]
data_info[data_info$RIC == sub("_slow","",variables[1]),]
data_info[data_info$RIC == sub("_slow","",variables[1]),]$name
class(data_info[data_info$RIC == sub("_slow","",variables[1]),])
data_info[data_info$RIC == sub("_slow","",variables[1]),][,1]
data_info[data_info$RIC == sub("_slow","",variables[1]),]$Name
for (i in 1:length(variables)) {
transform_code <- NA
info <- data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name)
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub("%","\\%",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub("%","!",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub("%","\\%",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub("%","\%",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
info <- sub("%","\\ %",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name))
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub("%","\\ %",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub("%","\\",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub("%","\\\\",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub("%","\\\\%",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub("$",'\\\\$',sub("%","\\\\%",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name)))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub('$','\\\\$',sub("%","\\\\%",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name)))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub(sub("%","\\\\%",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name)))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub("%","\\\\%",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,'& ', transform_code, '\\\\', '\n'))
}
for (i in 1:length(variables)) {
transform_code <- NA
info <- sub("%","\\\\%",sub("Russia, "," ",data_info[data_info$RIC == sub("_slow","",variables[i]),]$Name))
if(var_diffs[i] == 0)
transform_code <- '$\\l$'
if(var_diffs[i] == 1)
transform_code <- paste0('$\\Delta','$')
if(var_diffs[i] == 2)
transform_code <- paste0('$\\Delta^',var_diffs[i],'$')
cat(paste0(i,". ",sub('_slow', '*',variables[i]), ' & ',info ,' & ', transform_code, '\\\\', '\n'))
}
